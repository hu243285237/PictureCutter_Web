name: Sync Gitee

on:
  push:
    tags:
      - '*'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Mirror the Github organization repos to Gitee.
        uses: Yikun/gitee-mirror-action@v0.10
        with:
          # 必选，需要同步的Github用户（源）
          src: github/hu243285237
          # 必选，需要同步到的Gitee的用户（目的）
          dst: gitee/hu243285237
          # 必选，Gitee公钥对应的私钥，https://gitee.com/profile/sshkeys
          dst_key: ${{ secrets.GITEE_PRIVATE_KEY }}
          # 必选，Gitee对应的用于创建仓库的token，https://gitee.com/profile/personal_access_tokens
          dst_token: ${{ secrets.GITEE_TOKEN }}
          # 如果是组织，指定组织即可，默认为用户user
          # account_type: org
          # 还有黑、白名单，静态名单机制，可以用于更新某些指定库
          static_list: 'PictureCutter_Web'
          # black_list: "repo_name,repo_name2"
          # white_list: "PictureCutter_Web"

      # 等待 Gitee 同步完成后再触发 Pages，避免拿到非 Pages 页面导致 CSRF 解析失败
      - name: Wait for Gitee sync
        run: sleep 30

      - name: Gitee Pages Action
        # 触发 Gitee 从 gh-pages 分支重新部署 Pages（需在 Gitee 仓库设置里先开启 Gitee Pages）
        uses: yanglbme/gitee-pages-action@v1.4.1
        with:
          gitee-username: hu243285237
          gitee-password: ${{ secrets.GITEE_PASSWORD }}
          # 仓库路径：Gitee 地址栏多为小写，若仍报错请到 gitee.com 查看实际仓库 URL
          gitee-repo: hu243285237/picturecutter_web
          branch: gh-pages
          # Which directory to build
          # directory: # optional, default is
          # Use force https or not
          # https: # optional, default is true
